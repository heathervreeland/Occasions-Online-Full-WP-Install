// jQuery TimePicker plugin - http://github.com/wvega/timepicker
//
// A jQuery plugin to enhance standard form input fields helping users to select
// (or type) times.
//
// Copyright (c) 2010 Willington Vega, http://wvega.com/
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

if(typeof jQuery!="undefined"){(function(a){var b=function(e,c,d){return Array(d+1-e.length).join(c)+e};a.TimePicker=function(e,d){var c=this,f=e.ownerDocument;c.element=a(e).data("TimePicker",c).attr("autocomplete","off");c.selectedTime=a.fn.timepicker.parseTime(c.element.val());c.options=a.metadata?a.extend({},d,c.element.metadata()):d;if(c.element.attr("id").length===0){c.element.attr("id","timepicker-field-"+(new Date()).getTime())}c._build();c.menu.delegate("a","mouseenter.timepicker mouseleave.timepicker",function(g){if(g.type=="mouseover"){c._activate(a(this).parent())}else{c._deactivate()}}).delegate("a","click",function(g){g.preventDefault();c._select(a(this).parent())}).appendTo("body",f);c.element.bind("keydown.timepicker",function(g){switch(g.which){case c.keyCode.ENTER:case c.keyCode.NUMPAD_ENTER:g.preventDefault();if(c.closed){c.element.change()}else{c._select(c.active)}break;case c.keyCode.UP:c.previous();break;case c.keyCode.DOWN:c.next();break;default:c.close();break}}).bind("focus.timepicker",function(){c.open()}).bind("change.timepicker",function(g){if(c.closed){c.setTime(a.fn.timepicker.parseTime(c.element.val()))}})};a.TimePicker.prototype={keyCode:{DOWN:40,END:35,ENTER:13,HOME:36,LEFT:37,NUMPAD_ENTER:108,PAGE_DOWN:34,PAGE_UP:33,RIGHT:39,TAB:9,UP:38},_isValidTime:function(f){var d=this,e=null,c=null;f.setSeconds(0,0);if(d.options.minTime!==null){e=new Date();e.setTime(f.valueOf());e.setHours(d.options.minTime.getHours(),d.options.minTime.getMinutes(),0,0)}else{if(d.options.minHour!==null||d.options.minMinutes!==null){e=new Date();e.setTime(f.valueOf());if(d.options.minHour!==null){e.setHours(d.options.minHour,0,0,0)}if(d.options.minMinutes!==null){e.setMinutes(d.options.minMinutes,0,0)}}}if(d.options.maxTime!==null){c=new Date();c.setTime(f.valueOf());c.setHours(d.options.maxTime.getHours(),d.options.maxTime.getMinutes(),0,0)}else{if(d.options.maxHour!==null||d.options.maxMinutes!==null){c=new Date();c.setTime(f.valueOf());if(d.options.maxHour!==null){c.setHours(d.options.maxHour,0,0,0)}if(d.options.maxMinutes!==null){c.setMinutes(d.options.maxMinutes,0,0)}}}if(e!==null&&c!==null){return f>=e&&f<=c}else{if(e!==null){return f>=e}else{if(c!==null){return f<=c}}}return true},_populate:function(c){var r=this,q=null,o=60/r.options.interval,e,n,k,f,p,g="",j="",d=new Date();if(c){e=c.getHours();k=Math.ceil(c.getMinutes()/r.options.interval)}else{if(r.options.startTime){e=r.options.startTime.getHours();k=Math.ceil(r.options.startTime.getMinutes()/r.options.interval)}else{e=r.options.startHour;k=Math.ceil(r.options.startMinutes/r.options.interval)}}n=e+24+1;if(k>=o){e+=1;n+=1;k-=o}f=k;p=o;r.menu.empty();for(var m=e;m<n;m++){if(m==n-1){p=f}for(var l=k;l<p;l++){g=b((m%24).toString(),"0",2);j=b(((l%o)*r.options.interval).toString(),"0",2);d.setHours(g,j);if(r._isValidTime(d)){q=a("<li>").addClass("ui-menu-item").appendTo(r.menu);a("<a>").addClass("ui-corner-all").text(a.fn.timepicker.formatTime(r.options.timeFormat,d)).appendTo(q)}}k=0}},_build:function(){this.menu=a("<ul>",{id:"timepicker-"+(new Date()).getTime()}).addClass("ui-timepicker ui-widget ui-widget-content").addClass("ui-corner-all ui-helper-hidden");this.closed=true;this._populate()},_hasScroll:function(){return this.menu.height()<this.menu.attr("scrollHeight")},_activate:function(e){this._deactivate();if(this._hasScroll()){var f=e.offset().top-this.menu.offset().top,d=this.menu.scrollTop(),c=this.menu.height();if(f<0){this.menu.scrollTop(d+f)}else{if(f>c){this.menu.scrollTop(d+f-c+e.height())}}}this.active=e.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-item").end()},_deactivate:function(){if(!this.active){return}this.active.children("a").removeClass("ui-state-hover").removeAttr("id");this.active=null},_select:function(c){this.setTime(a.fn.timepicker.parseTime(c.children("a").text()));this.close()},_move:function(e,d){if(this.closed){this.open()}if(!this.active){this._activate(this.menu.children(d));return}var c=this.active[e+"All"](".ui-menu-item").eq(0);if(c.length){this._activate(c)}else{this._activate(this.menu.children(d))}},option:function(c,d){if(arguments.length>1){if(this.options.hasOwnProperty(c)){this.options[c]=d}return this}return this.options[c]},next:function(){this._move("next",".ui-menu-item:first")},previous:function(){this._move("prev",".ui-menu-item:last")},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},selected:function(){return this.active?this.active:null},open:function(){var c=this;if(c.closed){if(c.selectedTime){c._populate(c.selectedTime)}var d=c.element.offset();d.top=d.top+c.element.outerHeight();d.width=c.element.innerWidth();c.menu.css(d);c.menu.removeClass("ui-helper-hidden").addClass("ui-menu");a("html").bind("focusin.timepicker click.timepicker",function(f){var g=a(f.target),e=g.closest("#"+c.menu.attr("id"));if(e.length>0||g.attr("id")===c.element.attr("id")){}else{setTimeout(function(){c.close()},50)}});c.closed=false}return c.element},close:function(){var c=this;if(!c.closed){c.menu.scrollTop(0).addClass("ui-helper-hidden").removeClass("ui-menu");c.menu.children().removeClass("ui-state-hover");a("html").unbind(".timepciker");c.closed=true}return c.element},destroy:function(){return this.element.unbind(".timepicker").data("TimePicker",null)},getTime:function(){if(this.selectedTime){return this.selectedTime}return null},setTime:function(d){var c=this;if(d&&d.getMinutes){c.element.val(a.fn.timepicker.formatTime(c.options.timeFormat,d));c.selectedTime=d;if(c.options.change&&a.isFunction(c.options.change)){c.options.change(d)}}}};a.TimePicker.defaults={timeFormat:"hh:mm p",minHour:null,minMinutes:null,minTime:null,maxHour:null,maxMinutes:null,maxTime:null,startHour:7,startMinutes:0,startTime:null,interval:30,change:function(c){}};a.fn.timepicker=function(c){if(a.fn.jquery<"1.4.1"){return this}if(this.data("TimePicker")){return this.data("TimePicker")}var d=a.extend({},a.TimePicker.defaults,c);return this.each(function(){(new a.TimePicker(this,d))})};a.fn.timepicker.formatTime=function(l,c){var i=c.getHours(),g=i%12,f=c.getMinutes(),j=c.getSeconds(),d={hh:b((g===0?12:g).toString(),"0",2),HH:b(i.toString(),"0",2),mm:b(f.toString(),"0",2),ss:b(j.toString(),"0",2),h:(g===0?12:g),H:i,m:f,s:j,p:i>11?"PM":"AM"},h=l,e="";for(e in d){if(d.hasOwnProperty(e)){h=h.replace(new RegExp(e,"g"),d[e])}}return h};a.fn.timepicker.parseTime=(function(){var c=[[/^(\d+)$/,"$1"],[/^:(\d)$/,"$10"],[/^:(\d+)/,"$1"],[/^(\d):([7-9])$/,"0$10$2"],[/^(\d):(\d\d)$/,"$1$2"],[/^(\d):(\d{1,})$/,"0$1$20"],[/^(\d\d):([7-9])$/,"$10$2"],[/^(\d\d):(\d)$/,"$1$20"],[/^(\d\d):(\d*)$/,"$1$2"],[/^(\d{3,}):(\d)$/,"$10$2"],[/^(\d{3,}):(\d{2,})/,"$1$2"],[/^(\d):(\d):(\d)$/,"0$10$20$3"],[/^(\d{1,2}):(\d):(\d\d)/,"$10$2$3"]];return function(n){var l=new Date(),j=false,f=false,i=false,d=false,g=false,e=0;n=n.toLowerCase();j=/a/.test(n);f=j?false:/p/.test(n);n=n.replace(/[^0-9:]/g,"").replace(/:+/g,":");for(e in c){if(c[e][0].test(n)){n=n.replace(c[e][0],c[e][1]);break}}n=n.replace(/:/g,"");if(n.length==1){i=n}else{if(n.length==2){i=n}else{if(n.length==3||n.length==5){i=n.substr(0,1);d=n.substr(1,2);g=n.substr(3,2)}else{if(n.length==4||n.length>5){i=n.substr(0,2);d=n.substr(2,2);g=n.substr(4,2)}}}}if(n.length>0&&n.length<5){if(n.length<3){d=0}g=0}if(i===false||d===false||g===false){return false}i=parseInt(i,10);d=parseInt(d,10);g=parseInt(g,10);if(j&&i==12){i=0}else{if(f&&i<12){i=i+12}}if(i>24&&(i%10)<=6&&d<=60&&g<=60){return a.fn.timepicker.parseTime(n+"0"+(j?"a":"")+(f?"p":""))}else{if(i<=24&&d<=60&&g<=60){l.setHours(i,d,g);return l}else{return false}}}})()})(jQuery)};
